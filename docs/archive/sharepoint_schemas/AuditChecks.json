{
  "$schema": "https://developer.microsoft.com/json-schemas/sp/list-formatting.schema.json",
  "listName": "AuditChecks",
  "description": "Routine check compliance counts from trolley audits",
  "baseTemplate": "genericList",
  "columns": [
    {
      "internalName": "Title",
      "displayName": "Title",
      "type": "Text",
      "required": false,
      "maxLength": 50,
      "description": "Auto-populated based on parent audit"
    },
    {
      "internalName": "Audit",
      "displayName": "Audit",
      "type": "Lookup",
      "required": true,
      "lookupList": "Audit",
      "lookupField": "Title",
      "description": "Parent audit record"
    },
    {
      "internalName": "OutsideCheckCount",
      "displayName": "Outside Check Count",
      "type": "Number",
      "required": false,
      "minimum": 0,
      "description": "Number of daily outside checks completed"
    },
    {
      "internalName": "InsideCheckCount",
      "displayName": "Inside Check Count",
      "type": "Number",
      "required": false,
      "minimum": 0,
      "description": "Number of weekly inside checks completed"
    },
    {
      "internalName": "ExpectedOutside",
      "displayName": "Expected Outside",
      "type": "Number",
      "required": false,
      "description": "Expected outside checks based on location and period"
    },
    {
      "internalName": "ExpectedInside",
      "displayName": "Expected Inside",
      "type": "Number",
      "required": false,
      "description": "Expected inside checks based on period weeks"
    },
    {
      "internalName": "CountNotAvailable",
      "displayName": "Count Not Available",
      "type": "Boolean",
      "required": false,
      "defaultValue": false,
      "description": "True if check counts could not be determined"
    },
    {
      "internalName": "NotAvailableReason",
      "displayName": "Not Available Reason",
      "type": "Text",
      "required": false,
      "maxLength": 200,
      "description": "Reason why counts were not available"
    },
    {
      "internalName": "OutsideCompliance",
      "displayName": "Outside Compliance %",
      "type": "Calculated",
      "formula": "=IF([CountNotAvailable],0,IF([ExpectedOutside]=0,100,MIN(100,[OutsideCheckCount]/[ExpectedOutside]*100)))",
      "outputType": "Number",
      "description": "Outside check compliance percentage"
    },
    {
      "internalName": "InsideCompliance",
      "displayName": "Inside Compliance %",
      "type": "Calculated",
      "formula": "=IF([CountNotAvailable],0,IF([ExpectedInside]=0,100,MIN(100,[InsideCheckCount]/[ExpectedInside]*100)))",
      "outputType": "Number",
      "description": "Inside check compliance percentage"
    },
    {
      "internalName": "OverallCheckCompliance",
      "displayName": "Overall Check Compliance",
      "type": "Calculated",
      "formula": "=IF([CountNotAvailable],0,([OutsideCompliance]+[InsideCompliance])/2)",
      "outputType": "Number",
      "description": "Combined routine check compliance percentage"
    },
    {
      "internalName": "CheckNotes",
      "displayName": "Check Notes",
      "type": "Note",
      "required": false,
      "maxLength": 500,
      "description": "Additional context about routine checks"
    }
  ],
  "views": [
    {
      "name": "All Items",
      "viewType": "html",
      "isDefault": true,
      "viewFields": ["Audit", "OutsideCheckCount", "ExpectedOutside", "InsideCheckCount", "ExpectedInside", "OverallCheckCompliance"],
      "sortField": "Created",
      "sortDirection": "Descending"
    },
    {
      "name": "Low Compliance",
      "viewType": "html",
      "isDefault": false,
      "viewFields": ["Audit", "OutsideCompliance", "InsideCompliance", "OverallCheckCompliance"],
      "filter": "[OverallCheckCompliance] < 80"
    },
    {
      "name": "Not Available",
      "viewType": "html",
      "isDefault": false,
      "viewFields": ["Audit", "NotAvailableReason"],
      "filter": "[CountNotAvailable] = 1"
    }
  ]
}
